#include <catch.hpp>
#include "../model/GameState.h"
#include "../solver/Solver.h"
#include "../punter/OfflineProtocol.h"

using std::string;

namespace Catch {
    template<> std::string toString<River>(River const& r) {
        return string("{") + std::to_string(r.from) + "->" + std::to_string(r.to) + "}";
    }
}

string problem = R"(
{
  "punter":0,
  "punters":2,
  "map":{
    "sites":[
       {"id":0,"x":0,"y":0},{"id":1,"x":1,"y":0},{"id":2,"x":2,"y":0},{"id":3,"x":2,"y":-1},{"id":4,"x":2,"y":-2},{"id":5,"x":1,"y":-2},{"id":6,"x":0,"y":-2},{"id":7,"x":0,"y":-1}
    ],
    "rivers":[
       {"source":0,"target":1},{"source":1,"target":2},{"source":0,"target":7},{"source":7,"target":6},{"source":6,"target":5},{"source":5,"target":4},{"source":4,"target":3},{"source":3,"target":2},{"source":1,"target":7},{"source":1,"target":3},{"source":7,"target":5},{"source":5,"target":3}
    ],
    "mines":[1,5]
  }
})";

TEST_CASE("ISolverStrategy") {

    OfflineProtocol dummy;
    json j = json::parse(problem);
    auto game = dummy.extractStateFromSetupRequest(j);
    game->initMinDistances();
    Empire empire(*game, game->getPunterId());
    Prolongate prolonger(*game, empire);

    REQUIRE(game->getMinDistances().at(1)[5] == 2);
    REQUIRE(game->getMinDistances().at(5)[1] == 2);

    SECTION("Whole Solver") {
        Solver solver(*game);

        River r = solver.riverToClaim();
        solver.claimEdge(r.from, r.to, game->getPunterId());
        REQUIRE(solver.getEmpire().getScore() == 1);

        r = solver.riverToClaim();
        solver.claimEdge(r.from, r.to, game->getPunterId());
        REQUIRE(solver.getEmpire().getScore() == 10);

        r = solver.riverToClaim();
        solver.claimEdge(r.from, r.to, game->getPunterId());
        REQUIRE(solver.getEmpire().getScore() == 15);
    }

    SECTION("This one is not supposed to work on completely empty graph") {
        StrategyDecision d = prolonger.proposedMove();
        REQUIRE(d.isEmpty());
    }

    SECTION("'Incept' strategy") {
        Incept incept(*game, empire);
        StrategyDecision d = incept.proposedMove();
        CAPTURE(d.river)
        REQUIRE(d.scoreIncrease == 1);

        empire.claimEdge(d.river.from, d.river.to, game->getPunterId());
        incept.claimEdge(d.river.from, d.river.to, game->getPunterId());
        StrategyDecision d2 = incept.proposedMove();
        REQUIRE(d2.scoreIncrease == 1);
        bool has1 = d.river.contains(1) || d2.river.contains(1);
        REQUIRE(has1);
        bool has5 = d.river.contains(5) || d2.river.contains(5);
        REQUIRE(has5);
    }

    empire.claimEdge(1, 7, game->getPunterId());
    prolonger.claimEdge(1, 7, game->getPunterId());

    SECTION("'Prolongate existing' strategy") {
        StrategyDecision d = prolonger.proposedMove();
        REQUIRE(d.river == River(5, 7));
        REQUIRE(d.scoreIncrease == 9);

        empire.claimEdge(d.river.from, d.river.to, game->getPunterId());
        prolonger.claimEdge(d.river.from, d.river.to, game->getPunterId());

        d = prolonger.proposedMove();
        REQUIRE(d.scoreIncrease == 5);

        empire.claimEdge(d.river.from, d.river.to, game->getPunterId());
        prolonger.claimEdge(d.river.from, d.river.to, game->getPunterId());

        d = prolonger.proposedMove();
        REQUIRE(d.scoreIncrease == 5);
    }
}

string problem_tube = R"(
{
  "punter":0,
  "punters":4,
  "map":{"mines":[64,284,114,204,148],"rivers":[{"source":278,"target":302},{"source":30,"target":133},{"source":0,"target":1},{"source":0,"target":2},{"source":0,"target":75},{"source":0,"target":76},{"source":0,"target":33},{"source":0,"target":180},{"source":0,"target":191},{"source":1,"target":6},{"source":2,"target":24},{"source":3,"target":4},{"source":3,"target":5},{"source":3,"target":243},{"source":4,"target":10},{"source":4,"target":83},{"source":4,"target":86},{"source":5,"target":24},{"source":5,"target":183},{"source":5,"target":243},{"source":6,"target":7},{"source":7,"target":21},{"source":7,"target":80},{"source":7,"target":75},{"source":7,"target":179},{"source":8,"target":9},{"source":8,"target":232},{"source":8,"target":252},{"source":9,"target":10},{"source":10,"target":197},{"source":10,"target":86},{"source":10,"target":252},{"source":10,"target":25},{"source":11,"target":12},{"source":11,"target":13},{"source":12,"target":23},{"source":13,"target":16},{"source":14,"target":15},{"source":15,"target":18},{"source":16,"target":17},{"source":17,"target":19},{"source":18,"target":22},{"source":19,"target":20},{"source":20,"target":21},{"source":22,"target":23},{"source":24,"target":33},{"source":24,"target":58},{"source":24,"target":183},{"source":24,"target":253},{"source":25,"target":26},{"source":25,"target":27},{"source":25,"target":138},{"source":25,"target":182},{"source":25,"target":79},{"source":25,"target":85},{"source":26,"target":31},{"source":26,"target":73},{"source":26,"target":79},{"source":26,"target":95},{"source":27,"target":38},{"source":28,"target":29},{"source":28,"target":30},{"source":29,"target":51},{"source":30,"target":52},{"source":31,"target":32},{"source":32,"target":66},{"source":32,"target":105},{"source":32,"target":129},{"source":33,"target":34},{"source":33,"target":183},{"source":34,"target":62},{"source":35,"target":36},{"source":35,"target":37},{"source":36,"target":43},{"source":37,"target":42},{"source":37,"target":72},{"source":38,"target":39},{"source":39,"target":58},{"source":39,"target":279},{"source":39,"target":287},{"source":40,"target":41},{"source":40,"target":42},{"source":41,"target":51},{"source":43,"target":44},{"source":44,"target":50},{"source":45,"target":46},{"source":45,"target":113},{"source":46,"target":48},{"source":47,"target":48},{"source":47,"target":49},{"source":48,"target":57},{"source":49,"target":61},{"source":52,"target":53},{"source":53,"target":68},{"source":54,"target":55},{"source":54,"target":56},{"source":55,"target":69},{"source":56,"target":57},{"source":58,"target":256},{"source":58,"target":243},{"source":59,"target":60},{"source":59,"target":61},{"source":60,"target":63},{"source":60,"target":80},{"source":60,"target":90},{"source":62,"target":63},{"source":64,"target":65},{"source":64,"target":66},{"source":65,"target":67},{"source":65,"target":68},{"source":66,"target":147},{"source":66,"target":107},{"source":67,"target":72},{"source":69,"target":70},{"source":70,"target":71},{"source":73,"target":74},{"source":74,"target":85},{"source":74,"target":95},{"source":76,"target":87},{"source":77,"target":78},{"source":77,"target":79},{"source":78,"target":88},{"source":79,"target":222},{"source":81,"target":82},{"source":81,"target":83},{"source":82,"target":84},{"source":84,"target":85},{"source":86,"target":94},{"source":86,"target":183},{"source":87,"target":88},{"source":88,"target":221},{"source":88,"target":240},{"source":88,"target":276},{"source":88,"target":287},{"source":88,"target":298},{"source":89,"target":90},{"source":89,"target":91},{"source":89,"target":114},{"source":90,"target":114},{"source":91,"target":92},{"source":91,"target":290},{"source":92,"target":93},{"source":93,"target":94},{"source":93,"target":183},{"source":93,"target":300},{"source":95,"target":96},{"source":96,"target":129},{"source":96,"target":138},{"source":96,"target":173},{"source":97,"target":98},{"source":97,"target":99},{"source":98,"target":117},{"source":99,"target":103},{"source":100,"target":101},{"source":100,"target":102},{"source":100,"target":114},{"source":101,"target":126},{"source":101,"target":174},{"source":101,"target":110},{"source":102,"target":114},{"source":103,"target":104},{"source":104,"target":111},{"source":105,"target":106},{"source":106,"target":107},{"source":107,"target":130},{"source":107,"target":151},{"source":108,"target":109},{"source":108,"target":110},{"source":109,"target":113},{"source":109,"target":262},{"source":109,"target":110},{"source":110,"target":124},{"source":110,"target":131},{"source":111,"target":112},{"source":112,"target":121},{"source":113,"target":280},{"source":114,"target":115},{"source":114,"target":116},{"source":116,"target":122},{"source":117,"target":130},{"source":118,"target":119},{"source":118,"target":120},{"source":119,"target":123},{"source":120,"target":132},{"source":121,"target":127},{"source":122,"target":123},{"source":124,"target":125},{"source":125,"target":128},{"source":126,"target":131},{"source":127,"target":133},{"source":132,"target":134},{"source":135,"target":136},{"source":135,"target":137},{"source":136,"target":146},{"source":137,"target":144},{"source":137,"target":165},{"source":137,"target":150},{"source":138,"target":164},{"source":138,"target":166},{"source":138,"target":172},{"source":139,"target":140},{"source":140,"target":142},{"source":141,"target":142},{"source":141,"target":143},{"source":143,"target":157},{"source":144,"target":145},{"source":145,"target":151},{"source":146,"target":147},{"source":148,"target":149},{"source":148,"target":150},{"source":148,"target":167},{"source":148,"target":184},{"source":149,"target":155},{"source":150,"target":165},{"source":151,"target":152},{"source":151,"target":184},{"source":152,"target":156},{"source":153,"target":154},{"source":153,"target":155},{"source":154,"target":160},{"source":156,"target":157},{"source":158,"target":159},{"source":158,"target":160},{"source":159,"target":161},{"source":50,"target":302},{"source":133,"target":139},{"source":164,"target":165},{"source":167,"target":168},{"source":167,"target":169},{"source":167,"target":181},{"source":168,"target":172},{"source":169,"target":170},{"source":169,"target":171},{"source":174,"target":175},{"source":175,"target":177},{"source":176,"target":177},{"source":176,"target":178},{"source":178,"target":179},{"source":180,"target":192},{"source":181,"target":182},{"source":182,"target":197},{"source":182,"target":232},{"source":183,"target":282},{"source":185,"target":186},{"source":185,"target":187},{"source":186,"target":195},{"source":188,"target":189},{"source":188,"target":190},{"source":189,"target":196},{"source":190,"target":194},{"source":191,"target":192},{"source":191,"target":193},{"source":191,"target":196},{"source":193,"target":194},{"source":195,"target":196},{"source":196,"target":218},{"source":198,"target":199},{"source":199,"target":200},{"source":199,"target":201},{"source":201,"target":202},{"source":202,"target":204},{"source":203,"target":204},{"source":203,"target":205},{"source":204,"target":217},{"source":206,"target":207},{"source":206,"target":208},{"source":207,"target":212},{"source":207,"target":292},{"source":208,"target":216},{"source":209,"target":210},{"source":209,"target":211},{"source":209,"target":212},{"source":210,"target":218},{"source":211,"target":220},{"source":213,"target":214},{"source":213,"target":215},{"source":214,"target":216},{"source":217,"target":219},{"source":219,"target":220},{"source":221,"target":222},{"source":223,"target":224},{"source":223,"target":225},{"source":224,"target":250},{"source":225,"target":241},{"source":226,"target":227},{"source":226,"target":228},{"source":227,"target":244},{"source":228,"target":249},{"source":229,"target":230},{"source":229,"target":231},{"source":230,"target":239},{"source":231,"target":234},{"source":233,"target":234},{"source":233,"target":235},{"source":235,"target":237},{"source":236,"target":237},{"source":236,"target":238},{"source":239,"target":240},{"source":239,"target":241},{"source":239,"target":242},{"source":240,"target":242},{"source":240,"target":253},{"source":243,"target":279},{"source":244,"target":245},{"source":245,"target":246},{"source":246,"target":259},{"source":246,"target":297},{"source":246,"target":301},{"source":247,"target":248},{"source":247,"target":249},{"source":248,"target":260},{"source":250,"target":251},{"source":251,"target":254},{"source":251,"target":255},{"source":252,"target":259},{"source":253,"target":256},{"source":255,"target":261},{"source":257,"target":258},{"source":258,"target":261},{"source":262,"target":273},{"source":263,"target":264},{"source":263,"target":265},{"source":264,"target":280},{"source":265,"target":293},{"source":266,"target":267},{"source":266,"target":268},{"source":267,"target":275},{"source":268,"target":278},{"source":269,"target":270},{"source":269,"target":271},{"source":270,"target":281},{"source":270,"target":298},{"source":270,"target":299},{"source":271,"target":276},{"source":272,"target":273},{"source":272,"target":274},{"source":274,"target":289},{"source":275,"target":291},{"source":277,"target":278},{"source":281,"target":291},{"source":282,"target":290},{"source":283,"target":284},{"source":283,"target":285},{"source":283,"target":286},{"source":284,"target":285},{"source":286,"target":288},{"source":288,"target":289},{"source":292,"target":293},{"source":294,"target":295},{"source":294,"target":296},{"source":295,"target":299},{"source":300,"target":301},{"source":134,"target":260},{"source":128,"target":134},{"source":128,"target":285},{"source":215,"target":284},{"source":198,"target":215},{"source":198,"target":200},{"source":200,"target":205},{"source":14,"target":205},{"source":14,"target":187},{"source":187,"target":238},{"source":238,"target":254},{"source":254,"target":257},{"source":257,"target":277},{"source":161,"target":170},{"source":171,"target":297},{"source":64,"target":296},{"source":260,"target":297},{"source":260,"target":285},{"source":187,"target":205},{"source":205,"target":238},{"source":205,"target":254},{"source":205,"target":257},{"source":191,"target":231},{"source":13,"target":188},{"source":64,"target":130},{"source":64,"target":117},{"source":64,"target":98},{"source":64,"target":221},{"source":55,"target":284},{"source":213,"target":284},{"source":70,"target":284},{"source":198,"target":284},{"source":274,"target":284},{"source":45,"target":284}],"sites":[{"id":0,"x":-1610.64949811783,"y":528229.470602964},{"id":1,"x":-1672.16380103767,"y":528228.445364582},{"id":2,"x":-1501.44724436356,"y":528191.105800684},{"id":3,"x":-1278.47226235069,"y":528079.785799193},{"id":4,"x":-1253.86654118275,"y":528073.634368901},{"id":5,"x":-1375.86990864044,"y":528098.240090069},{"id":6,"x":-1721.37524337354,"y":528201.789166651},{"id":7,"x":-1804.72614316128,"y":528176.608458662},{"id":8,"x":-1026.26362037934,"y":527939.328140859},{"id":9,"x":-1143.14079592704,"y":527988.539583195},{"id":10,"x":-1171.84747062297,"y":528034.675310385},{"id":11,"x":-2639.98883364316,"y":528368.903022916},{"id":12,"x":-2828.63269593068,"y":528447.84637833},{"id":13,"x":-2540.54071058942,"y":528331.994441164},{"id":14,"x":-3435.57381807311,"y":528946.112231981},{"id":15,"x":-3241.80376387561,"y":528834.361248343},{"id":16,"x":-2306.78635949403,"y":528309.43919676},{"id":17,"x":-2098.66296794857,"y":528347.373016894},{"id":18,"x":-3158.75945493382,"y":528716.458834413},{"id":19,"x":-1987.93722269285,"y":528357.625400714},{"id":20,"x":-1900.79196022308,"y":528305.338243232},{"id":21,"x":-1881.31243096513,"y":528238.697748402},{"id":22,"x":-3110.57325097995,"y":528634.439763853},{"id":23,"x":-3037.78132585814,"y":528529.86544889},{"id":24,"x":-1450.71231052624,"y":528151.552485933},{"id":25,"x":-908.361206449648,"y":528134.123433439},{"id":26,"x":-843.771188383815,"y":528180.259160629},{"id":27,"x":-997.556945683417,"y":528147.451532405},{"id":28,"x":909.386444831646,"y":528875.370783623},{"id":29,"x":935.017404381579,"y":528981.99557535},{"id":30,"x":921.689305415614,"y":528772.846945423},{"id":31,"x":-562.855871716543,"y":528274.581091772},{"id":32,"x":-340.379142823119,"y":528253.05108575},{"id":33,"x":-1531.70614270403,"y":528143.350578877},{"id":34,"x":-1626.02807384779,"y":528137.199148585},{"id":35,"x":482.88727792075,"y":529295.718520242},{"id":36,"x":572.083017154519,"y":529445.403324013},{"id":37,"x":349.606288261095,"y":529094.77179737},{"id":38,"x":-1139.03984239905,"y":528187.435829303},{"id":39,"x":-1230.28605839681,"y":528176.158207101},{"id":40,"x":774.054978407996,"y":529204.472304244},{"id":41,"x":946.29502658355,"y":529158.336577054},{"id":42,"x":450.079649696835,"y":529198.320873952},{"id":43,"x":859.149764113776,"y":529489.488574439},{"id":44,"x":1059.07124860326,"y":529758.101030522},{"id":45,"x":-3093.14419848599,"y":528153.602962697},{"id":46,"x":-2879.89461503054,"y":528182.309637393},{"id":47,"x":-2536.43975706143,"y":528170.006776809},{"id":48,"x":-2662.54407804711,"y":528240.748225166},{"id":49,"x":-2295.50873729206,"y":528120.795334473},{"id":50,"x":1167.74651709498,"y":529983.653474562},{"id":51,"x":956.547410403523,"y":529053.76226209},{"id":52,"x":679.73304726424,"y":528782.074090861},{"id":53,"x":465.458225426795,"y":528780.023614097},{"id":54,"x":-3543.22384818283,"y":528431.442564218},{"id":55,"x":-3780.05391442421,"y":528492.956867138},{"id":56,"x":-3313.57045061542,"y":528373.003976444},{"id":57,"x":-3007.02417439821,"y":528307.388719996},{"id":58,"x":-1343.06228041652,"y":528166.931061663},{"id":59,"x":-2111.99106691453,"y":528074.659607283},{"id":60,"x":-2016.64389738878,"y":528094.139136541},{"id":61,"x":-2242.19634142819,"y":528044.927694205},{"id":62,"x":-1800.31859878734,"y":528119.770096091},{"id":63,"x":-1924.37244300902,"y":528107.467235507},{"id":64,"x":-54.3376342458593,"y":528578.051652843},{"id":65,"x":85.0947857057797,"y":528698.004543537},{"id":66,"x":-43.0600120438885,"y":528424.265895544},{"id":67,"x":221.451490511427,"y":528826.159341287},{"id":68,"x":295.268654015236,"y":528792.326474681},{"id":69,"x":-4088.65066740541,"y":528581.12736799},{"id":70,"x":-4206.55308133511,"y":528619.061188123},{"id":71,"x":-4486.44315962038,"y":528711.332642503},{"id":72,"x":281.94055504927,"y":528937.910324925},{"id":73,"x":-774.054978407996,"y":528144.375817259},{"id":74,"x":-785.332600609967,"y":528098.240090069},{"id":75,"x":-1742.90524939549,"y":528205.890120178},{"id":76,"x":-1475.31803169418,"y":528241.773463548},{"id":77,"x":-1003.7083759754,"y":528206.915358561},{"id":78,"x":-1079.57601624321,"y":528205.890120178},{"id":79,"x":-908.361206449648,"y":528188.461067684},{"id":80,"x":-1926.42291977301,"y":528121.820572855},{"id":81,"x":-1057.02077183926,"y":528120.795334473},{"id":82,"x":-963.724079077505,"y":528122.845811237},{"id":83,"x":-1169.79699385897,"y":528111.568189035},{"id":84,"x":-926.8154973256,"y":528113.618665799},{"id":85,"x":-884.780723663709,"y":528108.492473889},{"id":86,"x":-1285.64893102467,"y":528008.019112453},{"id":87,"x":-1393.29896113439,"y":528264.328707952},{"id":88,"x":-1269.24511691271,"y":528313.540150288},{"id":89,"x":-1875.16100067315,"y":527941.378617623},{"id":90,"x":-1973.58388534489,"y":528006.993874071},{"id":91,"x":-1781.86430791139,"y":527937.277664095},{"id":92,"x":-1604.49806782585,"y":527919.848611601},{"id":93,"x":-1483.51993875016,"y":527961.883385263},{"id":94,"x":-1368.69323996646,"y":527991.615298341},{"id":95,"x":-744.323065330073,"y":528155.653439461},{"id":96,"x":-627.445889782376,"y":528196.66297474},{"id":97,"x":830.44308941785,"y":528403.761127904},{"id":98,"x":531.073481874625,"y":528401.71065114},{"id":99,"x":1039.59171934531,"y":528392.483505702},{"id":100,"x":-2192.98489909232,"y":527900.369082343},{"id":101,"x":-2307.81159787603,"y":527932.151472185},{"id":102,"x":-2117.11725882452,"y":527902.419559107},{"id":103,"x":1302.05274513663,"y":528410.937796578},{"id":104,"x":1506.0751831541,"y":528425.291133926},{"id":105,"x":-253.233880353344,"y":528273.55585339},{"id":106,"x":-122.003367457684,"y":528252.025847368},{"id":107,"x":57.4133493918514,"y":528292.010144266},{"id":108,"x":-2745.58838698889,"y":527942.403856005},{"id":109,"x":-2871.69270797457,"y":528026.473403329},{"id":110,"x":-2611.28215894724,"y":527947.530047915},{"id":111,"x":1696.76952220561,"y":528451.947331858},{"id":112,"x":2026.89628120875,"y":528506.284966104},{"id":113,"x":-2954.73701691635,"y":528101.315805215},{"id":114,"x":-2022.79532768076,"y":527915.747658073},{"id":115,"x":-2159.15203248641,"y":527980.337676139},{"id":116,"x":-2002.29056004082,"y":527866.536215737},{"id":117,"x":351.656765025089,"y":528358.650639096},{"id":118,"x":-2165.30346277839,"y":527573.318038486},{"id":119,"x":-2141.72297999246,"y":527671.740923158},{"id":120,"x":-2118.14249720652,"y":527437.986572062},{"id":121,"x":2239.1206262822,"y":528550.37021653},{"id":122,"x":-1999.21484489482,"y":527796.820005762},{"id":123,"x":-2061.75438619666,"y":527744.53284828},{"id":124,"x":-2823.50650402069,"y":527910.621466163},{"id":125,"x":-2921.92938869243,"y":527761.961900774},{"id":126,"x":-2418.53734313174,"y":527938.302902477},{"id":127,"x":2402.13352901978,"y":528594.455466955},{"id":128,"x":-3089.043244958,"y":527621.50424244},{"id":129,"x":-481.862039538752,"y":528224.344411054},{"id":130,"x":176.341001703543,"y":528318.666342198},{"id":131,"x":-2521.06118133147,"y":527946.504809533},{"id":132,"x":-2042.27485693871,"y":527324.185111661},{"id":133,"x":2573.34833881334,"y":528602.657374011},{"id":134,"x":-2428.5831224637,"y":527264.042691619},{"id":135,"x":-133.280989659655,"y":528107.467235507},{"id":136,"x":-177.366240085541,"y":528226.394887818},{"id":137,"x":-177.366240085541,"y":528076.710084047},{"id":138,"x":-574.133493918514,"y":528117.719619327},{"id":139,"x":628.471128164373,"y":528149.502009169},{"id":140,"x":734.070681510099,"y":528096.189613305},{"id":141,"x":563.88111009854,"y":528086.962467867},{"id":142,"x":656.152564478301,"y":528084.911991103},{"id":143,"x":476.735847628766,"y":528083.886752721},{"id":144,"x":-67.6657332118248,"y":528078.760560811},{"id":145,"x":-21.5300060219443,"y":528093.113898159},{"id":146,"x":-213.249583455448,"y":528277.656806918},{"id":147,"x":-142.508135097631,"y":528349.423493658},{"id":148,"x":-214.274821837445,"y":528050.053886115},{"id":149,"x":-220.426252129429,"y":528031.599595239},{"id":150,"x":-208.123391545461,"y":528069.533415373},{"id":151,"x":84.0695473237823,"y":528148.476770787},{"id":152,"x":185.56814714152,"y":528091.063421395},{"id":153,"x":-147.634327007618,"y":527953.681478207},{"id":154,"x":-148.659565389615,"y":527897.293367197},{"id":155,"x":-195.820530961493,"y":528004.943397307},{"id":156,"x":282.965793431267,"y":528095.164374923},{"id":157,"x":344.480096351108,"y":528093.113898159},{"id":158,"x":-98.4228846717452,"y":527820.400488548},{"id":159,"x":-152.760518917605,"y":527773.239522976},{"id":160,"x":-103.549076581732,"y":527865.510977355},{"id":161,"x":-221.451490511427,"y":527731.204749314},{"id":164,"x":-405.994399270949,"y":528123.871049619},{"id":165,"x":-271.688171229297,"y":528097.214851687},{"id":166,"x":-761.752117824028,"y":528106.441997125},{"id":167,"x":-514.669667762667,"y":527979.312437757},{"id":168,"x":-538.250150548606,"y":528008.019112453},{"id":169,"x":-490.063946594731,"y":527929.075757039},{"id":170,"x":-335.252950913132,"y":527758.886185628},{"id":171,"x":-412.145829562933,"y":527748.633801808},{"id":172,"x":-572.083017154519,"y":528041.851979059},{"id":173,"x":-725.868774454121,"y":528230.495841346},{"id":174,"x":-2324.21541198798,"y":528016.221019509},{"id":175,"x":-2322.16493522399,"y":528057.230554789},{"id":176,"x":-2160.17727086841,"y":528174.107730337},{"id":177,"x":-2226.81776569823,"y":528140.274863731},{"id":178,"x":-2061.75438619666,"y":528213.066788852},{"id":179,"x":-1927.44815815501,"y":528192.562021213},{"id":180,"x":-1783.91478467538,"y":528353.524447186},{"id":181,"x":-653.076849332309,"y":527976.236722611},{"id":182,"x":-885.805962045707,"y":528051.079124497},{"id":183,"x":-1464.04040949221,"y":528066.457700227},{"id":184,"x":39.9842968978965,"y":528002.892920543},{"id":185,"x":-3021.37751174618,"y":529102.973704426},{"id":186,"x":-2933.20701089441,"y":528963.541284475},{"id":187,"x":-3104.42182068796,"y":529221.901356738},{"id":188,"x":-2447.24401782766,"y":528530.890687272},{"id":189,"x":-2566.17167013936,"y":528553.445931676},{"id":190,"x":-2270.90301612412,"y":528502.184012576},{"id":191,"x":-1848.50480274121,"y":528481.679244936},{"id":192,"x":-1781.86430791139,"y":528440.669709656},{"id":193,"x":-1954.10435608694,"y":528478.60352979},{"id":194,"x":-2098.66296794857,"y":528480.654006554},{"id":195,"x":-2856.3141322446,"y":528865.118399803},{"id":196,"x":-2865.54127768258,"y":528648.793101201},{"id":197,"x":-1078.55077786121,"y":528008.019112453},{"id":198,"x":-6223.19697872389,"y":529777.58055978},{"id":199,"x":-5751.58732300511,"y":529719.141972007},{"id":200,"x":-6264.20651400378,"y":530101.555888492},{"id":201,"x":-5313.81053389224,"y":529579.709552055},{"id":202,"x":-4852.45326199344,"y":529437.201416957},{"id":203,"x":-4523.35174137229,"y":529504.867150169},{"id":204,"x":-4429.02981022853,"y":529324.425194938},{"id":205,"x":-4282.42072160291,"y":529610.466703515},{"id":206,"x":-4070.19637652946,"y":528782.074090861},{"id":207,"x":-3807.73535073814,"y":528769.771230277},{"id":208,"x":-4229.10832573905,"y":528748.241224255},{"id":209,"x":-3450.95239380307,"y":528810.780765557},{"id":210,"x":-3264.35900827955,"y":528801.553620119},{"id":211,"x":-3717.51437312238,"y":528865.118399803},{"id":212,"x":-3622.16720359662,"y":528812.831242321},{"id":213,"x":-4612.54748060606,"y":528549.344978148},{"id":214,"x":-4532.57888681027,"y":528632.389287089},{"id":215,"x":-4906.7908962393,"y":528472.452099498},{"id":216,"x":-4319.32930335482,"y":528730.812171761},{"id":217,"x":-4347.01073966875,"y":529136.806571032},{"id":218,"x":-3028.55418042016,"y":528735.938363671},{"id":219,"x":-4195.27545913314,"y":529027.106064158},{"id":220,"x":-3901.0320434999,"y":528947.137470362},{"id":221,"x":-1084.70220815319,"y":528327.893487636},{"id":222,"x":-895.033107483683,"y":528267.404423098},{"id":223,"x":-1387.14753084241,"y":528667.247392077},{"id":224,"x":-1494.79756095213,"y":528794.376951445},{"id":225,"x":-1408.67753686435,"y":528579.076891226},{"id":226,"x":-1563.48853254595,"y":527414.406089277},{"id":227,"x":-1517.35280535607,"y":527512.828973948},{"id":228,"x":-1638.33093443176,"y":527342.639402537},{"id":229,"x":-1683.44142323964,"y":528514.48687316},{"id":230,"x":-1576.81663151192,"y":528449.896855094},{"id":231,"x":-1824.92431995528,"y":528580.102129608},{"id":232,"x":-966.799794223497,"y":528009.044350835},{"id":233,"x":-2189.90918394633,"y":528783.099329243},{"id":234,"x":-1989.98769945685,"y":528740.039317199},{"id":235,"x":-2316.013504932,"y":528847.689347309},{"id":236,"x":-2707.65456685499,"y":529051.711785326},{"id":237,"x":-2565.14643175736,"y":528976.86938344},{"id":238,"x":-2819.4055504927,"y":529163.462768964},{"id":239,"x":-1461.98993272821,"y":528399.660174376},{"id":240,"x":-1370.74371673045,"y":528286.883952356},{"id":241,"x":-1437.38421156028,"y":528517.562588306},{"id":242,"x":-1422.00563583032,"y":528348.398255276},{"id":243,"x":-1313.3303673386,"y":528113.618665799},{"id":244,"x":-1418.92992068433,"y":527606.12566671},{"id":245,"x":-1331.78465821455,"y":527637.908056552},{"id":246,"x":-1261.04320985674,"y":527713.77569682},{"id":247,"x":-1822.87384319128,"y":527157.071255395},{"id":248,"x":-1967.43245505291,"y":527130.415057463},{"id":249,"x":-1722.40048175554,"y":527254.468901685},{"id":250,"x":-1691.64333029562,"y":528893.825074499},{"id":251,"x":-1980.76055401887,"y":529035.307971214},{"id":252,"x":-1079.57601624321,"y":527878.839076321},{"id":253,"x":-1425.91492708482,"y":528216.075576984},{"id":254,"x":-2156.07631734042,"y":529107.074657954},{"id":255,"x":-1930.523873301,"y":529120.40275692},{"id":256,"x":-1380.99610055042,"y":528207.940596942},{"id":257,"x":-1992.03817622084,"y":529538.700016775},{"id":258,"x":-1836.20194215725,"y":529332.627101994},{"id":259,"x":-1158.519371657,"y":527812.198581491},{"id":260,"x":-1997.16436813083,"y":526995.08359104},{"id":261,"x":-1902.84243698707,"y":529206.522781008},{"id":262,"x":-3149.53230949585,"y":528009.044350835},{"id":263,"x":-3072.63943084604,"y":528415.038750106},{"id":264,"x":-2912.70224325446,"y":528274.581091772},{"id":265,"x":-3235.65233358362,"y":528517.562588306},{"id":266,"x":-1364.59228643847,"y":529191.144205278},{"id":267,"x":-1274.3713088227,"y":529095.797035752},{"id":268,"x":-1312.3051289566,"y":529353.131869633},{"id":269,"x":-1085.72744653519,"y":528598.556420483},{"id":270,"x":-1091.87887682717,"y":528655.969769875},{"id":271,"x":-1160.569848421,"y":528537.042117564},{"id":272,"x":-3332.02474149137,"y":527952.656239825},{"id":273,"x":-3221.29899623566,"y":527992.640536723},{"id":274,"x":-3610.88958139465,"y":527806.047151199},{"id":275,"x":-1124.68650505109,"y":528997.37415108},{"id":276,"x":-1217.98319781285,"y":528490.906390374},{"id":277,"x":-1533.75661946803,"y":529553.053354123},{"id":278,"x":-1351.2641874725,"y":529511.018580461},{"id":279,"x":-1274.3713088227,"y":528130.022479911},{"id":280,"x":-2959.86320882634,"y":528177.183445483},{"id":281,"x":-982.178369953457,"y":528727.736456615},{"id":282,"x":-1565.53900930995,"y":528025.448164947},{"id":283,"x":-4333.68264070278,"y":527658.412824192},{"id":284,"x":-4638.17844015599,"y":527703.523313},{"id":285,"x":-4588.96699782012,"y":527585.62089907},{"id":286,"x":-3952.29396259977,"y":527725.053319022},{"id":287,"x":-1275.3965472047,"y":528233.571556492},{"id":288,"x":-3757.49867002027,"y":527703.523313},{"id":289,"x":-3653.94959343854,"y":527724.02808064},{"id":290,"x":-1647.55807986973,"y":528013.145304363},{"id":291,"x":-1053.94505669327,"y":528924.582225959},{"id":292,"x":-3609.86434301265,"y":528660.070723403},{"id":293,"x":-3450.95239380307,"y":528581.12736799},{"id":294,"x":-427.524405292893,"y":528886.648405825},{"id":295,"x":-608.991598906423,"y":528902.026981555},{"id":296,"x":-199.921484489482,"y":528848.714585691},{"id":297,"x":-1173.89794738696,"y":527615.352812148},{"id":298,"x":-1066.24791727724,"y":528469.376384352},{"id":299,"x":-767.903548116012,"y":528840.512678635},{"id":300,"x":-1367.66800158446,"y":527888.066221759},{"id":301,"x":-1284.62369264267,"y":527855.258593535},{"id":302,"x":-251.724467287223,"y":529955.9719068}]}
})";

TEST_CASE("Empire_can_claimEdge") {
    OfflineProtocol dummy;
    json j = json::parse(problem_tube);
    auto game = dummy.extractStateFromSetupRequest(j);
    game->initMinDistances();
    Empire empire(*game, game->getPunterId());
    empire.claimEdge(game->toInternalId(278), game->toInternalId(302), 0);
}

